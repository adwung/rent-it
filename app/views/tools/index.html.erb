<h1>Tool Search Result</h1>
<h2><%= @result.count %> Items Found</h2>


<div class="sort_by">
  <label for="sort_by">Sort By:</label>
  <select id="sort_by">
    <option value="category">Category</option>
    <option value="distance">Distance</option>
  </select>
</div>

<div class="tools">
  <% @result.each do |tool|%>
      <div class="tool">
        <%= image_tag tool.picture.thumb %>
        <ul>
          <li>Name: <%= tool.name %></li>
          <li>Category: <span class="category"><%= tool.category.name %></span></li>
          <li>Deposit: <%= currency_symbol %><%= humanized_money tool.deposit %></li>
          <li>Daily Rate: <%= currency_symbol %><%= humanized_money tool.daily_rate %></li>
          <% if @lat && @lng %>
              <li>Distance from your location:
                <span class="distance">
                <%= tool.distance_to([@lat, @lng]).round (2)%>
              </span> km</li>
          <% end %>
          <li><%= link_to tool do %>Detail<% end %></li>
          <li>Add to cart</li>
        </ul>
      </div>
  <%end%>
</div>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){
      var $tools = $('.tool');

      function sort_tools($sort_by_value){
          $tools.sort(function(a, b){
              var an = $(a).find('.' + $sort_by_value).text();
              var bn = $(b).find('.' + $sort_by_value).text();
              if(an > bn) {
                  return 1;
              }
              if(an < bn) {
                  return -1;
              }
              return 0;
          });
      }

      sort_tools($('#sort_by').val());
      $tools.detach().appendTo('.tools');

      $('#sort_by').change(function(){
          sort_tools($(this).val());
          $tools.detach().appendTo('.tools');
      })

  });
</script>